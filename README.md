Build Your Own Framework (BYOF) using PHP
=========================================

problems and design decisions.


コンポーネントの組み合わせ
----------------------

PHPでもバージョン5.3での名前空間の導入とcomposerの登場により、独立したライブラリ（コンポーネント）を組み合わせて使うことが簡単になりました。SymfonyやLaravelなど、多くのフレームワークはコンポーネントをベースにして構築されています。今後はYii2やCakePHP3なども登場してきてますが、全てコンポーネントベースです。

と同時に、自分の好きなコンポーネントを選んで、フレームワークを自作しようという話題も多く見かけるようになりました。Silexとかよい例かもしれません。StackPHPを使った非常に簡単なコードを見るだけで、自分でも作れる気になってきます。

で、実際に作ったりしたのですが…

簡単な機能でよければ簡単に作れます。が、使っていて物足りない、仕事に使える気がしないわけです。そもそも単純な機能であれば、SlimやSilexと言った有名なMicro-Frameworkを使えば十分なわけです。

一方、機能を追加してゆくと…

自分で作りこんでいるわけなので、好きなだけ機能は追加できるし複雑にもできます。が、それで出来たモノが、果たして使いやすいか、長期間での運用に耐えうるかといえば、とても思えなかったわけです。



「なぜ？」が知りたい
-------------

自作で本格的なフレームワークを作り込んだという話は検索しても余り見当たりません。だいたいは簡単なサンプル、あるいは作ったよ、という話で終わっている場合が多い気がします。一方、有名なフレームワークを見れば、使い方などのマニュアルは充実してますし、コードを読めば解決した方法は分かります。

とはいえ、
*   マニュアル＝使い方、
*   ソースコード＝実装方法、

しか分かりません。

一方、自分が知りたのは何か、を考えてみると、
*   フレームワークを設計する際に出てくる問題は何なのか？
*   その解決方法には何があって、何を採用するかの判断基準、

という部分です。

もう少し説明すると、ほとんどの開発・設計においては次のステップを踏むと思います。

1. 解決したい問題の提起、
2. 設計方針の決定、
3. 問題の解決（実装）、
4. 使い方などマニュアルを作成。


フレームワークを作るとなると、大きな問題（概念設計）から細かな問題まで、雑多な点を考慮しなくてはできません。殆どの場合では完璧な解決方法はなく、考えられる関係方法のメリット・デメリットを勘案した上で、より良いと思われる解決法を選びます。選ぶ理由というのが設計方針となります。

一方、どんな問題を想定して、どういう方向で解決しようとしたかについては、あまりお目にかかったことがありません。

> 知っているフレームワークはごく限られてます。仕事で使ったのはLaravel4.2、コードを読み込んだのはAuraPHP、Bear.Sundayの一部、Slim Framework、StackPHPぐらいです。この中では多分、Bear.Sundayのブログに、設計の話が一番詳しく書いてあります。


単にコードを読み込んで真似る、だけではなく、解決しようとしている問題はなにか？なぜ、この実装にしたのか、を考えこまないと、一貫性のある使いやすいフレームワークにならない、と思うようになりました。




自作フレームワークの利点
-------------------

ところで、なんでフレームワークを自作するのでしょう。

自分の場合は長期間、例えば10年ぐらい、にわたって運用するためです。

そしてフレームワークに比べて、コンポーネントのほうが長生きと思うからです。

### コンポーネントに依存したい

したがって長期間サポートするプロジェクトでは、フレームワークではなく、コンポーネントに依存するほうが運用が楽なのではないかと考えているからです。

例えば、一部の機能を更新する場合を考えます。例えばセキュリティパッチが出る、新しい機能で使いたいものが出た、という場合です。

フレームワークを使っていると、全てのコンポーネントが更新されてしまうかもしれません。互換性や使い勝手などが大きく損なわれるケースというはあると思います。

一方、コンポーネントであれば、必要な部分のみを更新することが可能です。そして十分に疎結合であれば、更新の影響は限られる「はず」です。

### コードの内部まで知りたい

時間がたつと、どんなに有名なフレームワークでも、情報がなくなってしまいます。結局、自分でソースコードを読み込んで、必要な修正を行うことになります。その場合は、自作フレームワークのほうが安心感がある、と思うからです。

あくまで、よく出来たフレームワークであれば、という前提ですが。

よく出来たフレームワークとは
-----------------------

「よく出来た」というのは何か？を考えてみます。

「一貫性があること」。

一貫性があれば、いつでもコードを追いかければ、内容を理解して修正しやすいフレームワークになると考えます。この場合はこっち、あの場合はそっち、だと疲れますよね。

「合理的であること」

ちゃんと、設計方針を説明できて理解しやすいこと。これがあれば、後からでもコードを追いかけやすいです。

「なぜ？を説明してあること」

使い方はコードを見れば分かります。いや、やっぱりマニュアルがある方がめちゃくちゃ便利ですが。が、なぜ、どうして、こうなったのか？の説明があると、いざというときに修正しやすいと思います。

